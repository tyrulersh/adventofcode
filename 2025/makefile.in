TEST_CASES = $(patsubst tst/%.input.txt,test-%,$(wildcard tst/*.input.txt))

all: test

$(PROGRAM): src/$(PROGRAM).hs
	ghc -o $@ $<

test: $(TEST_CASES)

test-%: tst/%.input.txt tst/%.expected.txt $(PROGRAM)
	@(cmp --silent <(cat $< | ./$(PROGRAM)) $(word 2,$^) && echo -e "\e[32mPASS\e[0m" $@) || true
	@(cmp --silent <(cat $< | ./$(PROGRAM)) $(word 2,$^) || echo -e "\e[31mFAIL\e[0m" $@) && diff -u <(cat $< | ./$(PROGRAM)) $(word 2,$^) || true

clean:
	rm -f $(PROGRAM) src/$(PROGRAM).hi src/$(PROGRAM).o
